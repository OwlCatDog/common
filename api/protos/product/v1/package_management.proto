syntax = "proto3";

package api.product.v1;

option go_package = "product/v1;v1";

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

service PackageManagement {
  // 获取套餐详情
  rpc GetPlan(GetPlanRequest) returns (GetPlanResponse);
  //  商户获取套餐详情
  rpc MerchantGetPlan(MerchantGetPlanRequest) returns (MerchantGetPlanResponse);
}

// 套餐状态枚举
enum PlanStatus {
  PLAN_STATUS_UNSPECIFIED = 0;
  PLAN_STATUS_DRAFT = 1;        // 草稿
  PLAN_STATUS_ACTIVE = 2;       // 上架
  PLAN_STATUS_INACTIVE = 3;     // 下架
  PLAN_STATUS_DISCONTINUED = 4; // 停产
}

// 值类型枚举
enum ValueType {
  VALUE_TYPE_UNSPECIFIED = 0;
  VALUE_TYPE_STRING = 1;        // 字符串
  VALUE_TYPE_NUMBER = 2;        // 数字
  VALUE_TYPE_BOOLEAN = 3;       // 布尔值
  VALUE_TYPE_DECIMAL = 4;       // 小数
}

// 套餐规则配置
message PlanParameter {
  uint32 id = 1 [json_name = "id"];                                       // 参数ID
  uint32 rule_id = 2 [json_name = "ruleId"];                              // 规则ID
  string rule_key = 3 [json_name = "ruleKey"];                            // 规则键名
  string rule_value = 4 [json_name = "ruleValue"];                        // 规则值
  ValueType value_type = 5 [json_name = "valueType"];                     // 值类型
  bool is_stackable = 6 [json_name = "isStackable"];                      // 是否可叠加购买
  google.protobuf.Struct rule_i18n = 7 [json_name = "ruleI18n"];          // 规则多语言内容
  optional string unit = 8 [json_name = "unit"];                          // 单位
  string rule_type = 9 [json_name = "ruleType"];                          // 规则类型
  bool is_unlimited = 10 [json_name = "isUnlimited"];                     // 是否无限制
}

// 产品套餐信息
message ProductPlanInfo {
  string product_code = 2 [json_name = "productCode"];                        // 产品ID
  string plan_code = 3 [json_name = "planCode"];                          // 套餐编码
  string plan_name = 17 [json_name = "planName"];                        // 套餐名称
  google.protobuf.Struct i18n = 4 [json_name = "i18n"];                   // 多语言内容
  optional string badge_color = 5 [json_name = "badgeColor"];             // 标识颜色
  int64 price_monthly = 6 [json_name = "priceMonthly"];                  // 月付价格
  int64 price_yearly = 7 [json_name = "priceYearly"];                    // 年付价格
  string currency = 8 [json_name = "currency"];                           // 货币单位
  int32 sort_order = 10 [json_name = "sortOrder"];                        // 排序
  PlanStatus status = 11 [json_name = "status"];                          // 状态
  bool is_trial_enabled = 12 [json_name = "isTrialEnabled"];              // 是否支持试用
  int32 trial_days = 13 [json_name = "trialDays"];                        // 试用天数
  google.protobuf.Timestamp create_time = 14 [json_name = "createTime"];  // 创建时间
  google.protobuf.Timestamp update_time = 15 [json_name = "updateTime"];  // 更新时间
  repeated PlanParameter parameters = 16 [json_name = "parameters"];      // 套餐规则配置
}

// 获取套餐请求
message GetPlanRequest {
  string plan_code = 1 [json_name = "planCode"];                          // 套餐编码
  optional bool include_parameters = 2 [json_name = "includeParameters"]; // 是否包含规则配置
}

// 获取套餐响应
message GetPlanResponse {
  ProductPlanInfo plan = 1 [json_name = "plan"];                          // 套餐信息
}

//  商户获取套餐请求
message MerchantGetPlanRequest {
  string plan_code = 3 [json_name = "planCode"];                          // 套餐编码
  optional bool include_parameters = 2 [json_name = "includeParameters"]; // 是否包含规则配置
}

//  商户获取套餐响应
message MerchantGetPlanResponse {
  ProductPlanInfo plan = 1 [json_name = "plan"];                          // 套餐信息
}